/*
 * TypingStructure.h
 * NtTrace Analyzer
 * @author Gregoire JACOB (gregoire.jacob@orange-ftgroup.com)
 * @date 02/09/2008
 * @version 1.0
 */

//Object types
#define TYPE_VAR	1
#define TYPE_PERM	2
#define TYPE_COM	3
#define TYPE_BOOT	4
#define TYPE_THIS	5
static char typestr[6][15] = {"unknown","var","objperm","objcom","objboot","this"};
//Object natures
#define OBJ_FILE	1
#define OBJ_FOLD	2
#define	OBJ_DRIVE	3
#define OBJ_REG		4
#define OBJ_NETW	5
#define OBJ_MAIL	6
#define VAR			7
static char naturestr[8][15] = {"none","file","folder","drive",
								"registry key","network","mail","variable"}; 
//Object status
#define OBJ_EXIST	1
#define OBJ_CREATED	0

#define NAME_MAX_LENGTH 256
#define MAXNBREF		20

//Object type
struct TYPED_OBJ{
	char			ObjectName[NAME_MAX_LENGTH];
	int				nbref;
	unsigned long	Handles[MAXNBREF];
	unsigned long	Address;
	int				Type;
	int				Nature;
	int				Status;
	int				Size;
};

#define OBJECTNB	20000
//Global typing structure
struct TYPING{
	int		nbobj;
	struct	TYPED_OBJ objects[OBJECTNB];
};


/**
 * printStructures()
 * @param the structure to render
 * Print the different information of a given structure in the console
 */
void printTypedObject(struct TYPED_OBJ * object, int number);
void printfTypedObject(FILE * f, struct TYPED_OBJ * object, int number);
void printTyping(struct TYPING * types);
void printfTyping(FILE * f, struct TYPING * types);

/**
 * storeStructures()
 * @param the structure to render
 * @param the file storing the object database
 * Store in a database the different information in a binary mode
 */
void storeTypedObject(FILE * db, struct TYPED_OBJ * object);
void storeTyping(FILE * db, struct TYPING * types);

/**
 * isKnownObject()
 * @param the current typing structure
 * @param the tested name (may be NULL)
 * @param the tested reference
 * @return the index of the object if present in the table, otherwise -1
 * Test if the given token is already in the table as name, or reference
 */
int isKnownObject(struct TYPING * types, char *  name, unsigned long ref);

/**
 * addNewObject()
 * @param the current typing structure
 * @param the object name (may be null)
 * @param the object nature
 * @return the index of the created object
 * @warning the object type is determined by a call to the classifier
 */
int addNewObject(struct TYPING * types, char * name, int nature);

//Access and updates methods
unsigned long getObjectAddress(struct TYPING * types, int obj);
int getObjectType(struct TYPING * types, int obj);
int getObjectNature(struct TYPING * types, int obj);
int getObjectSize(struct TYPING * types, int obj);
void setObjectType(struct TYPING * types, int obj, int type);
void setObjectNature(struct TYPING * types, int obj, int nature);
void setObjectStatus(struct TYPING * types, int obj, int status);
void setObjectAddress(struct TYPING * types, int obj, unsigned long address);
void setObjectSize(struct TYPING * types, int obj, int size);
void addObjectHandle(struct TYPING * types, int obj, unsigned long handle);
void removeObjectHandle(struct TYPING * types, int obj, unsigned long handle);
void updateObjectType(struct TYPING * types, int obj);
